<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>uketsuke</title>
    
    <link rel="icon" href="uketsuke.png" type="image/png">
    <link rel="apple-touch-icon" href="uketsuke.png">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="uketsuke">

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        :root { 
            --primary-blue: #007AFF; 
            --bg-gray: #f2f2f7; 
            --radius-standard: 12px; 
            --radius-small: 8px;
        }
        body { font-family: -apple-system, "Helvetica Neue", sans-serif; margin: 0; background: #fff; color: #000; -webkit-tap-highlight-color: transparent; }
        .container { padding: 20px; max-width: 100%; margin: 0 auto; box-sizing: border-box; }
        .toolbar { display: flex; align-items: center; gap: 10px; padding: 10px 0; margin-bottom: 10px; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
        .toolbar::-webkit-scrollbar { display: none; }
        .btn-base { border: none; border-radius: var(--radius-standard); display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: 600; transition: opacity 0.2s; }
        .btn-base:active { opacity: 0.7; }
        .btn-tool { width: 44px; height: 44px; font-size: 18px; background: #f0f0f5; border: 1px solid rgba(0,0,0,0.05); position: relative; overflow: hidden; border-radius: var(--radius-standard); }
        .btn-action { padding: 0 20px; height: 44px; font-size: 14px; background: #f0f0f5; color: #333; border-radius: var(--radius-standard); }
        .row-action { height: 38px; padding: 0 8px; font-size: 10px; border-radius: var(--radius-small); border: none; color: #fff; font-weight: bold; flex-shrink: 0; }
        .color-input-hidden { position: absolute; top: -10px; left: -10px; width: 60px; height: 60px; cursor: pointer; opacity: 0; }
        .header-display { font-weight: bold; margin-bottom: 15px; min-height: 40px; padding: 5px 0; line-height: 1.3; }
        .btn-display-list { display: flex; flex-direction: column; gap: 12px; width: 100%; }
        .display-item { border: none; border-radius: 16px; padding: 24px 20px; display: flex; align-items: baseline; text-decoration: none; font-weight: bold; width: 100%; box-sizing: border-box; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .spacer { flex: 1; min-width: 10px; }
        .edit-scroll { height: calc(100vh - 180px); overflow-y: auto; padding: 10px 0; }
        .edit-row { background: #f9f9f9; padding: 10px 6px; border-radius: var(--radius-standard); margin-bottom: 12px; display: flex; align-items: center; gap: 4px; border: 2px solid #eee; transition: all 0.2s; }
        .edit-row.selected { border-color: var(--primary-blue); background: #f0f7ff; }
        .edit-row:focus-within { border-color: #eee; background: #f9f9f9; }
        .input-group { display: flex; gap: 2px; flex: 1; }
        .input-group input { width: 33%; padding: 10px 4px; border: 2px solid #ddd; border-radius: 6px; font-size: 11px; background: #fff; outline: none; transition: border-color 0.2s; box-sizing: border-box; }
        .input-group input:focus { border-color: var(--primary-blue); background: #fff; }
        .compact-stepper { display: flex; align-items: center; border: 1px solid #ddd; border-radius: var(--radius-standard); background: #fff; height: 44px; overflow: hidden; flex-shrink: 0; }
        .compact-stepper button { width: 35px; border: none; background: transparent; height: 100%; cursor: pointer; font-size: 18px; color: var(--primary-blue); }
        .compact-stepper span { width: 40px; text-align: center; font-size: 12px; font-weight: bold; border-left: 1px solid #eee; border-right: 1px solid #eee; line-height: 44px; }
        .align-group { display: flex; gap: 4px; background: #f0f0f5; padding: 4px; border-radius: var(--radius-standard); flex-shrink: 0; }
        .align-btn { width: 36px; height: 36px; border: none; border-radius: var(--radius-small); cursor: pointer; background: transparent; display: flex; align-items: center; justify-content: center; color: #8e8e93; }
        .align-btn.active { background: #fff; color: var(--primary-blue); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .align-icon { display: flex; flex-direction: column; gap: 2px; width: 14px; }
        .align-icon span { height: 2px; background: currentColor; border-radius: 1px; }
        .align-left { align-items: flex-start; } .align-left span:nth-child(1) { width: 100%; } .align-left span:nth-child(2) { width: 65%; } .align-left span:nth-child(3) { width: 85%; }
        .align-center { align-items: center; } .align-center span:nth-child(1) { width: 100%; } .align-center span:nth-child(2) { width: 55%; } .align-center span:nth-child(3) { width: 80%; }
        .align-right { align-items: flex-end; } .align-right span:nth-child(1) { width: 100%; } .align-right span:nth-child(2) { width: 65%; } .align-right span:nth-child(3) { width: 85%; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .modal-content { background: #fff; padding: 24px; border-radius: 24px; width: 85%; max-width: 320px; text-align: center; box-shadow: 0 10px 25 rgba(0,0,0,0.1); }
        .modal input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ddd; border-radius: var(--radius-standard); box-sizing: border-box; font-size: 16px; text-align: center; }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btns button { flex: 1; padding: 14px; border: none; border-radius: var(--radius-standard); font-weight: bold; cursor: pointer; font-size: 14px; background: #eee; }
        .btn-add { width:100%; padding:16px; border-radius:var(--radius-standard); border: 2px dashed #ccc; background:transparent; font-weight:bold; cursor:pointer; color: #888; margin-top: 10px; }
    </style>
</head>
<body>
<div id="app" class="container" @click="resetSelection">
    <div class="toolbar" @click.stop>
        <template v-if="isEditing">
            <button @click="openModal('change')" class="btn-base btn-tool">üîë</button>
            <div class="spacer"></div>
            <div class="compact-stepper">
                <button @click="changeSizeUniversal(false)">‚àí</button>
                <span>{{ currentContextSize }}</span>
                <button @click="changeSizeUniversal(true)">+</button>
            </div>
            <div class="align-group">
                <button v-for="n in [0,1,2]" :key="n" @click="changeAlignmentUniversal(n)" :class="['align-btn', {active: currentContextAlignment === n}]">
                    <div :class="['align-icon', alignClassMap[n]]">
                        <span></span><span></span><span></span>
                    </div>
                </button>
            </div>
            <div class="btn-base btn-tool" :style="{ background: currentTextColorDisplay }">
                <input type="color" v-model="textAndHeaderColorProxy" class="color-input-hidden">
            </div>
            <div class="btn-base btn-tool" :style="{ background: currentBgColorDisplay }">
                <input type="color" v-model="backgroundColorProxy" class="color-input-hidden">
            </div>
        </template>
        <div v-else class="spacer"></div>
        <button @click="handleConfigButton" class="btn-base btn-action" :style="isEditing ? 'background:#8e8e93; color:#fff' : ''">
            {{ isEditing ? 'ÂÆå‰∫Ü' : 'Ë®≠ÂÆö' }}
        </button>
    </div>

    <div v-if="!isEditing" class="btn-display-list">
        <div class="header-display" :style="headerDynamicStyle">
            {{ headerMessage }}
        </div>
        <a v-for="item in shortcuts" :key="item.id" :href="'facetime://' + item.address" class="display-item" :style="{ background: item.colorHex, color: item.textColorHex }">
            <div v-if="item.alignment != 0" class="spacer"></div>
            <span :style="{ fontSize: item.titleSizeValue + 'px' }">{{ item.title }}</span>
            <span v-if="item.subTitle" :style="{ fontSize: item.subTitleSizeValue + 'px', marginLeft: '12px' }">{{ item.subTitle }}</span>
            <div v-if="item.alignment != 2" class="spacer"></div>
        </a>
    </div>

    <div v-else @click.stop>
        <div class="edit-row" style="background: #fff; border-style: dashed;">
            <input v-model="headerMessage" placeholder="„Éò„ÉÉ„ÉÄ„Éº" style="flex:1; padding:10px; border-radius:var(--radius-small); border:2px solid #ddd; font-size:14px;" @focus="onHeaderFocus">
        </div>

        <div class="edit-scroll">
            <div v-for="item in shortcuts" :key="item.id" 
                 class="edit-row" 
                 :class="{selected: selectedIDs.includes(item.id)}"
                 @click="onRowClick(item.id)">
                <div class="input-group">
                    <input v-model="item.title" placeholder="„Çø„Ç§„Éà„É´" @focus.stop="setFocus(item.id, 'title')">
                    <input v-model="item.subTitle" placeholder="Ë™¨Êòé" @focus.stop="setFocus(item.id, 'sub')">
                    <input v-model="item.address" placeholder="„Ç¢„Éâ„É¨„Çπ" @focus.stop="setFocus(item.id, 'address')">
                </div>
                <button @click.stop="duplicateSingle(item)" class="btn-base row-action" style="background:var(--primary-blue);">Ë§áË£Ω</button>
                <button @click.stop="deleteSingle(item.id)" class="btn-base row-action" style="background:#FF3B30;">ÂâäÈô§</button>
            </div>
            <button @click="addItem" class="btn-add">Ôºã È†ÖÁõÆ„ÇíËøΩÂä†</button>
        </div>
    </div>

    <div v-if="showModal !== 'none'" class="modal" @click.stop>
        <div class="modal-content">
            <h3 style="margin:0 0 10px 0; font-size: 18px;">{{ modalTitle }}</h3>
            <input type="password" v-model="pwInput" placeholder="" @keyup.enter="modalAction" :style="errorMsg ? 'border-color:#FF3B30; background:#FFF8F8;' : ''">
            <div v-if="errorMsg" style="color:#FF3B30; font-size:12px; margin-top:-10px; margin-bottom:15px; font-weight:bold;">{{ errorMsg }}</div>
            <div class="modal-btns">
                <button v-if="showModal !== 'setup'" @click="closeModal">„Ç≠„É£„É≥„Çª„É´</button>
                <button style="background:var(--primary-blue); color:#fff;" @click="modalAction">OK</button>
            </div>
        </div>
    </div>
</div>

<script>
const FONT_PRESETS = [8, 9, 10, 10.5, 11, 12, 14, 16, 18, 20, 24, 28, 32, 36, 42, 48, 54, 60, 72, 84, 96, 110, 120];
const ALIGN_MAP = ['left', 'center', 'right'];

Vue.createApp({
    data() {
        return {
            isEditing: false, 
            shortcuts: [], 
            selectedIDs: [],
            headerMessage: '', 
            headerFontSizeValue: 32, 
            headerTextColorHex: '#000000', 
            headerAlignment: 1,
            savedPassword: '', 
            pwInput: '', 
            showModal: 'none', 
            errorMsg: '',
            focusedID: null, 
            focusedType: 'title',
            alignClassMap: ['align-left', 'align-center', 'align-right']
        }
    },
    computed: {
        modalTitle() {
            return { setup: '„Éë„Çπ„ÉØ„Éº„Éâ‰ΩúÊàê', auth: '„Éë„Çπ„ÉØ„Éº„ÉâÂÖ•Âäõ', change: '„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥' }[this.showModal];
        },
        headerDynamicStyle() {
            return {
                fontSize: this.headerFontSizeValue + 'px',
                textAlign: ALIGN_MAP[this.headerAlignment],
                color: this.headerTextColorHex
            };
        },
        currentContextSize() {
            const item = this.shortcuts.find(s => s.id === this.selectedIDs[0]);
            if (item) {
                return (this.focusedID === item.id && this.focusedType === 'sub') ? item.subTitleSizeValue : item.titleSizeValue;
            }
            return this.headerFontSizeValue;
        },
        currentContextAlignment() {
            const item = this.shortcuts.find(s => s.id === this.selectedIDs[0]);
            return item ? item.alignment : this.headerAlignment;
        },
        currentTextColorDisplay() {
            const item = this.shortcuts.find(s => s.id === this.selectedIDs[0]);
            return item ? item.textColorHex : this.headerTextColorHex;
        },
        currentBgColorDisplay() {
            const item = this.shortcuts.find(s => s.id === this.selectedIDs[0]);
            return item ? item.colorHex : '#f0f0f5';
        },
        textAndHeaderColorProxy: {
            get() { return this.currentTextColorDisplay; },
            set(val) {
                if (this.selectedIDs.length > 0) {
                    this.shortcuts.filter(s => this.selectedIDs.includes(s.id)).forEach(s => s.textColorHex = val);
                } else {
                    this.headerTextColorHex = val;
                }
            }
        },
        backgroundColorProxy: {
            get() { return this.currentBgColorDisplay; },
            set(val) {
                if (this.selectedIDs.length > 0) {
                    this.shortcuts.filter(s => this.selectedIDs.includes(s.id)).forEach(s => s.colorHex = val);
                }
            }
        }
    },
    watch: {
        shortcuts: { handler() { this.save(); }, deep: true },
        headerMessage() { this.save(); }, 
        headerFontSizeValue() { this.save(); },
        headerTextColorHex() { this.save(); }, 
        headerAlignment() { this.save(); },
        savedPassword() { this.save(); }
    },
    mounted() {
        this.loadSettings();
    },
    methods: {
        loadSettings() {
            this.headerMessage = localStorage.getItem('hM') || "‚ñºÂæ°Áî®„ÅÆÈÉ®ÁΩ≤„Çí„ÅîÈÅ∏Êäû„Åè„Å†„Åï„ÅÑ‚ñº";
            this.headerFontSizeValue = Number(localStorage.getItem('hSV')) || 32;
            this.headerTextColorHex = localStorage.getItem('hC') || "#000000";
            this.headerAlignment = Number(localStorage.getItem('hA')) || 1;
            this.savedPassword = localStorage.getItem('app_pwd') || "";
            const sh = localStorage.getItem('sh');
            this.shortcuts = sh ? JSON.parse(sh) : [{ 
                id: crypto.randomUUID(), 
                title: "Âèó‰ªò", 
                subTitle: "Reception", 
                address: "", 
                colorHex: "#D5D5D5", 
                textColorHex: "#000000", 
                titleSizeValue: 54, 
                subTitleSizeValue: 36, 
                alignment: 1 
            }];
        },
        save() {
            localStorage.setItem('hM', this.headerMessage);
            localStorage.setItem('hSV', this.headerFontSizeValue);
            localStorage.setItem('hC', this.headerTextColorHex);
            localStorage.setItem('hA', this.headerAlignment);
            localStorage.setItem('app_pwd', this.savedPassword);
            localStorage.setItem('sh', JSON.stringify(this.shortcuts));
        },
        onRowClick(id) {
            this.selectedIDs = [id];
            this.focusedID = id;
        },
        setFocus(id, type) {
            this.selectedIDs = [id];
            this.focusedID = id;
            this.focusedType = type;
        },
        onHeaderFocus() {
            this.focusedID = null;
            this.selectedIDs = [];
        },
        resetSelection() {
            this.selectedIDs = [];
            this.focusedID = null;
        },
        addItem() {
            const newItem = { 
                id: crypto.randomUUID(), 
                title: "", 
                subTitle: "", 
                address: "", 
                colorHex: "#D5D5D5", 
                textColorHex: "#000000", 
                titleSizeValue: 48, 
                subTitleSizeValue: 24, 
                alignment: 1 
            };
            this.shortcuts.push(newItem);
            this.selectedIDs = [newItem.id];
        },
        deleteSingle(id) {
            this.shortcuts = this.shortcuts.filter(s => s.id !== id);
        },
        duplicateSingle(item) {
            const idx = this.shortcuts.findIndex(s => s.id === item.id);
            this.shortcuts.splice(idx + 1, 0, { ...item, id: crypto.randomUUID() });
        },
        changeSizeUniversal(inc) {
            const next = (curr) => {
                if (inc) return FONT_PRESETS.find(v => v > curr) || curr;
                return [...FONT_PRESETS].reverse().find(v => v < curr) || curr;
            };

            if (this.selectedIDs.length > 0) {
                this.shortcuts.forEach(s => {
                    if (this.selectedIDs.includes(s.id)) {
                        if (this.focusedID === s.id && this.focusedType === 'sub') {
                            s.subTitleSizeValue = next(s.subTitleSizeValue);
                        } else {
                            s.titleSizeValue = next(s.titleSizeValue);
                        }
                    }
                });
            } else {
                this.headerFontSizeValue = next(this.headerFontSizeValue);
            }
        },
        changeAlignmentUniversal(val) {
            if (this.selectedIDs.length > 0) {
                this.shortcuts.filter(s => this.selectedIDs.includes(s.id)).forEach(s => s.alignment = val);
            } else {
                this.headerAlignment = val;
            }
        },
        handleConfigButton() {
            if (this.isEditing) {
                this.isEditing = false;
                this.selectedIDs = [];
            } else {
                this.openModal(this.savedPassword ? 'auth' : 'setup');
            }
        },
        openModal(type) {
            this.errorMsg = '';
            this.pwInput = '';
            this.showModal = type;
        },
        closeModal() {
            this.showModal = 'none';
            this.errorMsg = '';
            this.pwInput = '';
        },
        modalAction() {
            if (this.showModal === 'setup' || this.showModal === 'change') {
                if (this.pwInput) {
                    this.savedPassword = this.pwInput;
                    this.isEditing = true;
                    this.closeModal();
                } else {
                    this.errorMsg = '„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                }
            } else if (this.showModal === 'auth') {
                if (this.pwInput === this.savedPassword) {
                    this.isEditing = true;
                    this.closeModal();
                } else {
                    this.errorMsg = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÁï∞„Å™„Çä„Åæ„Åô';
                    this.pwInput = '';
                }
            }
        }
    }
}).mount('#app');
</script>
</body>
</html>